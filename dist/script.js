"use strict";const body=document.body,container=document.getElementById("container"),input=document.getElementById("search"),menu=document.getElementById("suggestions_menu"),overlay=document.getElementById("overlay"),linkArrow=document.getElementById("link_arrow"),userCard=document.getElementById("user_card"),userImage=document.getElementById("user_image"),userDescreption=document.getElementById("user_descreption"),userName=document.getElementById("user_name"),userBio=document.getElementById("user_bio"),userFollower=document.getElementById("user_followers"),userFollowing=document.getElementById("user_following"),userUsername=document.getElementById("user_username"),userURL=document.getElementById("user_url");let intervalId,userData=[],index=-1;const headers={Authorization:"token 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","Content-Type":"application/json"},loadBodyBackground=()=>{let e=new Image;e.src="img/space.jpg",e.addEventListener("load",()=>{body.style.backgroundImage=`url('${e.src}')`})},unselect=()=>{index=-1,userData&&userData.forEach(e=>{e.classList.remove("bg-[#484f6683]")})},showUserCard=()=>{overlay.classList.add("custom"),container.classList.add("custom"),userCard.classList.add("custom")},hideUserCard=()=>{overlay.classList.remove("custom"),container.classList.remove("custom"),userCard.classList.remove("custom")},deleteMenu=()=>{index=-1,menu.innerHTML=""},loadAvatar=(e,t)=>{let n=new Image;n.src=e,n.addEventListener("load",()=>{t.src=n.src})},highlight=e=>{let t=userData[e];userData.forEach(e=>{e.classList.remove("bg-[#484f6683]")}),t.classList.add("bg-[#484f6683]")},getAverageColor=async e=>{var t,n,r,a,s=document.createElement("canvas"),i=s.getContext&&s.getContext("2d"),d={r:0,g:0,b:0},l=0;r=s.height=e.naturalHeight||e.offsetHeight||e.height,n=s.width=e.naturalWidth||e.offsetWidth||e.width,i.drawImage(e,0,0),a=(t=i.getImageData(0,0,n,r)).data.length;for(var o=0;o<a;o+=4)d.r+=t.data[o],d.g+=t.data[o+1],d.b+=t.data[o+2],l++;d.r=Math.floor(d.r/l),d.g=Math.floor(d.g/l),d.b=Math.floor(d.b/l)},renderCard=async function(){let e=userData[index].getAttribute("name");console.log(e);let t=await fetch(`https://api.github.com/users/${e}`,{headers}).then(e=>e.json()).then(e=>e);input.value="",userURL.href=t.html_url,userImage.src="img/github-user.png",userName.textContent=t.name,userUsername.textContent=t.login,userFollower.textContent=t.followers,userFollowing.textContent=t.following,loadAvatar(t.avatar_url,userImage);let n;n=t.bio?t.bio:"No bio :-(";let r=new Typewriter(userBio,{delay:30});r.typeString(n).start(),deleteMenu(),showUserCard(),deleteMenu()},hideCard=function(){hideUserCard()},renderMenu=function(){menu.style.display="",menu.innerHTML="",userData=userData.map((e,t)=>{let n=`<li class="user_list p-3 flex rounded-lg m-2 transition-all duration-100" data-index='${t}' name='${e.login}'>&nbsp;<img src="img/github-user.png" alt="${e.login} png" class="h-10 my-auto rounded-full" /><h5 class="leading-10 transition duration-300 ">&nbsp;${e.login}&nbsp;</h5></li>`;return menu.insertAdjacentHTML("beforeend",n),loadAvatar(e.avatar_url,menu.lastChild.querySelector("img")),menu.lastChild})},displaySuggestions=async function(e){try{userData=await fetch(`https://api.github.com/search/users?q=${e}&per_page=5&page=1`).then(e=>{if(!e.ok)throw Error("Data is not fetched");return e.json()}).then(e=>e.items).catch(e=>{}),renderMenu()}catch(t){}};body.addEventListener("click",e=>{e.target==overlay&&(menu.style.display="none",hideCard())}),document.addEventListener("keydown",e=>{"Escape"==e.key&&hideCard()}),menu.addEventListener("mouseover",e=>{let t=e.target.closest(".user_list");t&&highlight(index=t&&e.target.closest(".user_list").dataset.index)}),menu.addEventListener("click",renderCard),input.addEventListener("keydown",e=>{let t=e.key;"ArrowDown"==t||"ArrowUp"==t?("ArrowDown"==t?index++:index<=0?index=userData.length-1:index--,highlight(index=index&&index%userData.length)):"Enter"==t?(-1==index&&(index=0),userData.length&&renderCard()):(index=-1,clearTimeout(intervalId),input.value.length>1?intervalId=setTimeout(function(){input.value.length&&displaySuggestions(input.value)},200):deleteMenu())}),input.addEventListener("click",()=>{menu.style.display="",unselect()}),userUsername.addEventListener("mouseover",e=>{linkArrow.classList.add("custom")}),userUsername.addEventListener("mouseout",()=>{linkArrow.classList.remove("custom")}),loadBodyBackground();